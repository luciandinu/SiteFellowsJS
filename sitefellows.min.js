/* SiteFellowsJS */
const SFConstants={SITE:{},FIREBASE:{AppJs:"https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js",AuthJS:"https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"},CMS_COMPATIBILITY:{sitejet:"sitejet"},EVENTS:{loginSuccess:"sitefellows/login",loginError:"sitefellows/login-error"}},SFUtils={UUID:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))},IsB64:function(e){if(""===e||""===e.trim())return!1;try{return btoa(atob(e))==e}catch(e){return!1}},B64Encode:function(e){return btoa(unescape(encodeURIComponent(e)))},B64Decode:function(e){return decodeURIComponent(escape(atob(e)))},CheckIfHTMLElementExists:function(e){return!!document.querySelectorAll(e).length},CheckIfEmailAddressIsValid:function(e){return!!String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)},RedirectToURL:function(e){console.log("Redirecting to:",e),window.location.href=e},ShowHideElements:function(e,t){document.querySelectorAll(e).forEach((function(e){e.style.visibility=t?"visible":"hidden",e.style.display=t?null:"none"}))},ShowLoader:function(e){SFUtils.ShowHideElements("html",!e)},MakeSelectorCompatibleWithCMS:function(e,t){switch(t.toLowerCase()){case SFConstants.CMS_COMPATIBILITY.sitejet:return"body:not(.edit) "+e;default:return e}},IsInCMSEditor:function(e){switch(e.toLowerCase()){case SFConstants.CMS_COMPATIBILITY.sitejet:return!!window.editor;default:return!1}},GetLocalStoreConfig:function(){var e=window.localStorage.getItem("sitefellows-config");return e?JSON.parse(e):null},GetLocalStoreUser:function(){var e=window.localStorage.getItem("sitefellows-user");return e?JSON.parse(e):null},GetLocalStoreUserRoles:function(){var e=window.localStorage.getItem("sitefellows-user-roles");return e?JSON.parse(e):null}},SiteFellows=function(){var e;function t(e,t){var n=document.createElement("script");n.setAttribute("src",e),t&&(n.onload=t),document.head.appendChild(n)}async function n(){var t,n,o,s=window.localStorage,i=s.getItem("sitefellows-config"),l=s.getItem("sitefellows-config-timestamp"),r=l?new Date(l):null,a=new Date(Date.now())-r;if(i&&a<6e5)e=JSON.parse(i);else{var c=(t="data-site-config",o=document.head,sElements=o.querySelectorAll("script"),sElements.forEach((function(e){var o=e.getAttribute(t);o&&(n=o)})),n),f=await async function(e,t){try{const e=await fetch(t);return await("json"?e.json():e.text())}catch(e){console.warn("File fetching error:",e)}}(0,c);localStorage.setItem("sitefellows-config",JSON.stringify(f)),s.setItem("sitefellows-config-timestamp",new Date(Date.now())),e=f}}function o(){t(SFConstants.FIREBASE.AppJs,(function(){t(SFConstants.FIREBASE.AuthJS,(function(){firebase.initializeApp(e.FIREBASE),console.log("initializeFirebase:",firebase),firebase.auth().onAuthStateChanged(e=>{var t=window.localStorage;e?t.setItem("sitefellows-user",JSON.stringify(e)):t.removeItem("sitefellows-user"),console.log("onAuthStateChanged",e),l(),SiteFellowsUI.Update(),SFUtils.ShowLoader(!1)})}))}))}function s(){firebase.auth().signOut().then((function(){window.localStorage.removeItem("sitefellows-user")}),(function(e){}))}function i(){var t=e.SITE.rules,n=[];const o=window.location.pathname;if(t.forEach((function(e){switch(e.type.toLowerCase()){case"exact":(function(e,t){var n=t.match(e);return n&&t===n[0]})(e.path,o)&&n.push({roles:e.roles,ranking:2,path:e.path});break;case"starstwith":o.startsWith(e.path)&&n.push({roles:e.roles,ranking:1,path:e.path})}})),n.length>0){var s,i=0,l=0;return n.forEach((function(e){i=e.ranking>i?e.ranking:i,(l=e.path.length>l?e.path.length:l)==e.path.length&&i==e.ranking&&(s=e)})),{path:s.path,roles:s.roles}}}function l(){let t=SFUtils.GetLocalStoreUser(),n=SFUtils.GetLocalStoreUserRoles(),o=i()?i():null;if(console.log("matchingRuleForURL",o),console.log("authUserRoles",n),o)if(t){if(n){var s=n.filter((function(e){let t;return o.roles&&o.roles.forEach((function(n){n==e&&(t=e)})),t}));if(console.log("foundRoles",s),0==s.length){let t=e.SITE.paths.restricted?e.SITE.paths.restricted:"/";SFUtils.RedirectToURL(t)}}}else{let t=e.SITE.paths.login?e.SITE.paths.login:"/";SFUtils.RedirectToURL(t)}}return{_Init:async function(){await n(),e&&(o(),l())},UserLoginWithEmail:function(e,t,n){!function(e,t,n){firebase.auth().signInWithEmailAndPassword(e,t).then((function(e){var t=e.user;console.log(t),window.localStorage.setItem("sitefellows-user",JSON.stringify(t));const o=new CustomEvent("sitefellows/login");document.dispatchEvent(o),n&&SFUtils.RedirectToURL(n)})).catch((function(e){var t=e.code,n=e.message;console.warn("Firebase login error:",t,n);const o=new CustomEvent("sitefellows/login-error",{detail:n});document.dispatchEvent(o)}))}(e,t,n)},UserSignOut:function(){s()},ClearCache:function(){var e=window.localStorage;e.removeItem("sitefellows-config"),e.removeItem("sitefellows-config-timestamp"),e.removeItem("sitefellows-user"),s()}}}(),SiteFellowsUI=function(){function e(e,t){e.innerText=t,e.classList.add("show")}function t(t,n,o){return 0==t.value.length&&(e(n,o),!0)}function n(){window.localStorage;let e=SFUtils.GetLocalStoreUser();document.querySelectorAll(".sf-generated-modal").forEach((function(e){e.remove()})),SFUtils.CheckIfHTMLElementExists('[href="#sf-login"]')&&SFUtils.ShowHideElements('[href="#sf-login"]',!e),SFUtils.CheckIfHTMLElementExists('[href="#sf-login-modal"]')&&SFUtils.ShowHideElements('[href="#sf-login-modal"]',!e),SFUtils.CheckIfHTMLElementExists('[href="#sf-register"]')&&SFUtils.ShowHideElements('[href="#sf-register"]',!e),SFUtils.CheckIfHTMLElementExists('[href="#sf-logout"]')&&SFUtils.ShowHideElements('[href="#sf-logout"]',!!e),SFUtils.CheckIfHTMLElementExists(".sf-login-form")&&SFUtils.ShowHideElements(".sf-login-form",!e),SFUtils.CheckIfHTMLElementExists(".sf-register-form")&&SFUtils.ShowHideElements(".sf-register-form",!e)}function o(e="",t=""){const n=`data-id="${SFUtils.UUID()}"`;let o=`\n        <div class="sf-modal-container" ${n}>\n        <div class="sf-modal">\n            <div class="sf-header">\n                <h3>${e}</h3>\n                <div class="sf-button"></div>\n            </div>\n            <div class="sf-content"></div>\n            ${t?`<div class="sh-footer">${t}</div>`:""}\n        </div>\n        </div>`;var s=document.createElement("div");return s.classList.add("sf-generated-modal"),s.innerHTML=o,document.querySelector("body").appendChild(s),document.querySelector("["+n+"].sf-modal-container .sf-button").addEventListener("click",(function(e){console.log("bla"),s.remove()})),`.sf-modal-container[${n}] .sf-content`}function s(o,s){const i=`data-id="${SFUtils.UUID()}"`,l=`\n        <div class="sf-login-form sf-form-container" ${i}>\n        <div class="sf-form">\n            <div class="sf-form-field">\n                <label for="sf-login-user-email">Email</label>\n                <input type="email" name="sf-login-user-email" id="sf-login-user-email" placeholder="your.email@example.com">\n            </div>\n\n            <div class="sf-form-field">\n                <label for="sf-login-user-pass">Password</label>\n                <input type="password" name="sf-login-user-pass" id="sf-login-user-pass" placeholder="Enter your password">\n            </div>\n            <div class="sf-error-message">Error Message</div>\n            <button class="sf-button submit">Log in</button>\n        </div>\n    </div>`;if(SFUtils.CheckIfHTMLElementExists(o)){const m="["+i+"]";var r;document.querySelector(o).innerHTML=l;var a=document.querySelector(m+".sf-login-form"),c=document.querySelector(m+".sf-login-form #sf-login-user-email"),f=document.querySelector(m+".sf-login-form #sf-login-user-pass"),u=document.querySelector(m+".sf-login-form .sf-error-message");function d(n,o,s){return!t(n,s,"Email can't be empty.")&&(!function(t,n,o){return!SFUtils.CheckIfEmailAddressIsValid(t.value)&&(e(n,o),!0)}(n,s,"Email address is not valid.")&&!t(o,s,"Password can't be empty."))}document.querySelector(m+".sf-login-form .sf-button.submit").addEventListener("click",(function(e){u.classList.remove("show"),d(c,f,u)&&(a.classList.add("load"),r=i,SiteFellows.UserLoginWithEmail(c.value,f.value,s))})),document.addEventListener("sitefellows/login-error",(function(t){r==i&&e(u,t.detail),a.classList.remove("load")})),document.addEventListener("sitefellows/login",(function(e){a.classList.remove("load"),n()}))}}function i(e,t,n){if(SFUtils.CheckIfHTMLElementExists(e)){document.querySelector(e).addEventListener("click",(function(e){let o=SFUtils.GetLocalStoreConfig();n&&n(),SFUtils.RedirectToURL(o.SITE.paths[t]?o.SITE.paths[t]:""),e.preventDefault(),e.stopPropagation()}))}}return{_Init:function(){document.addEventListener("DOMContentLoaded",(function(e){!function(){if(i('[href="#sf-login"]',"login"),i('[href="#sf-register"]',"register"),i('[href="#sf-logout"]',"",(function(){SiteFellows.UserSignOut()})),SFUtils.CheckIfHTMLElementExists('[href="#sf-login-modal"]')){document.querySelector('[href="#sf-login-modal"]').addEventListener("click",(function(e){s(o("Login")),e.preventDefault(),e.stopPropagation()}))}}(),n()}))},RenderLoginForm:function(e,t){s(e,t)},RenderLoginModal:function(e){s(o("Login"))},DisplayRule:function(e,t,n){},Update:function(){n()}}}();SFUtils.ShowLoader(!0),SiteFellows._Init(),SiteFellowsUI._Init();