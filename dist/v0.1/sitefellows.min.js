/* SiteFellowsJS */
const SFConstants={SITE:{},FIREBASE:{AppJs:"https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js",AuthJS:"https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"},CMS_COMPATIBILITY:{sitejet:"sitejet"},EVENTS:{loginSuccess:"sitefellows/login",loginError:"sitefellows/login-error",configLoaded:"sitefellow/config-loaded",configLoadedAndHTMLLoaded:"sitefellow/config-and-html-loaded"}},SFUtils={UUID:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))},IsB64:function(e){if(""===e||""===e.trim())return!1;try{return btoa(atob(e))==e}catch(e){return!1}},B64Encode:function(e){return btoa(unescape(encodeURIComponent(e)))},B64Decode:function(e){return decodeURIComponent(escape(atob(e)))},CheckIfHTMLElementExists:function(e){return!!document.querySelectorAll(e).length},CheckIfEmailAddressIsValid:function(e){return!!String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)},RedirectToURL:function(e){window.location.href=e},ShowHideElements:function(e,t){document.querySelectorAll(e).forEach((function(e){e.style.visibility=t?"visible":"hidden !important",e.style.display=t?null:"none"}))},ShowLoader:function(e){SFUtils.ShowHideElements("html",!e)},MakeSelectorCompatibleWithCMS:function(e,t){switch(t.toLowerCase()){case SFConstants.CMS_COMPATIBILITY.sitejet:return"body:not(.edit) "+e;default:return e}},IsInCMSEditor:function(e){switch(e.toLowerCase()){case SFConstants.CMS_COMPATIBILITY.sitejet:return!!window.editor;default:return!1}},GetLocalStoreConfig:function(){var e=window.localStorage.getItem("sitefellows-config");return e?JSON.parse(e):null},GetLocalStoreUser:function(){var e=window.localStorage.getItem("sitefellows-user");return e?JSON.parse(e):null},GetLocalStoreUserRoles:function(){var e=window.localStorage.getItem("sitefellows-user-roles");return e?JSON.parse(e):null}},SiteFellows=function(){var e;function t(e,t){var n=document.createElement("script");n.setAttribute("src",e),t&&(n.onload=t),document.head.appendChild(n)}async function n(){var t,n,o,i=window.localStorage,s=i.getItem("sitefellows-config"),l=i.getItem("sitefellows-config-timestamp"),r=l?new Date(l):null,a=new Date(Date.now())-r;if(s&&a<6e5)e=JSON.parse(s);else{var c=(t="data-site-config",o=document.head,sElements=o.querySelectorAll("script"),sElements.forEach((function(e){var o=e.getAttribute(t);o&&(n=o)})),n),f=await async function(e,t){try{const e=await fetch(t);return await("json"?e.json():e.text())}catch(e){console.warn("File fetching error:",e)}}(0,c);localStorage.setItem("sitefellows-config",JSON.stringify(f)),i.setItem("sitefellows-config-timestamp",new Date(Date.now())),e=f}}function o(){t(SFConstants.FIREBASE.AppJs,(function(){t(SFConstants.FIREBASE.AuthJS,(function(){firebase.initializeApp(e.FIREBASE),firebase.auth().onAuthStateChanged(e=>{var t=window.localStorage;e?t.setItem("sitefellows-user",JSON.stringify(i(e))):t.removeItem("sitefellows-user"),r(),SiteFellowsUI.Update()})}))}))}function i(e){return e?{displayName:e.displayName,email:e.email,emailVerified:e.emailVerified,photoURL:e.photoURL,creationTime:e.metadata.creationTime,lastSignInTime:e.metadata.lastSignInTime,uid:e.uid,refreshToken:e.refreshToken}:null}function s(){firebase.auth().signOut().then((function(){window.localStorage.removeItem("sitefellows-user")}),(function(e){}))}function l(){var t=e.SITE.rules,n=[];const o=window.location.pathname;if(t.forEach((function(e){switch(e.type.toLowerCase()){case"exact":(function(e,t){var n=t.match(e);return n&&t===n[0]})(e.path,o)&&n.push({roles:e.roles,ranking:2,path:e.path});break;case"starstwith":o.startsWith(e.path)&&n.push({roles:e.roles,ranking:1,path:e.path})}})),n.length>0){var i,s=0,l=0;return n.forEach((function(e){s=e.ranking>s?e.ranking:s,(l=e.path.length>l?e.path.length:l)==e.path.length&&s==e.ranking&&(i=e)})),{path:i.path,roles:i.roles}}}function r(){let t=SFUtils.GetLocalStoreUser(),n=SFUtils.GetLocalStoreUserRoles(),o=l()?l():null;if(o)if(t){if(n)if(0==n.filter((function(e){let t;return o.roles&&o.roles.forEach((function(n){n==e&&(t=e)})),t})).length){let t=e.SITE.paths.restricted?e.SITE.paths.restricted:"/";SFUtils.RedirectToURL(t)}}else{let t=e.SITE.paths.login?e.SITE.paths.login:"/";SFUtils.RedirectToURL(t)}}return{_Init:async function(){await n();const e=new Event("sitefellow/config-loaded");document.dispatchEvent(e),o(),document.addEventListener("sitefellow/config-loaded",(function(){SFUtils.IsInCMSEditor(SFUtils.GetLocalStoreConfig().SITE.options.cmsCompatibility)||r()}))},UserLoginWithEmail:function(e,t,n){!function(e,t,n){firebase.auth().signInWithEmailAndPassword(e,t).then((function(e){var t=e.user;window.localStorage.setItem("sitefellows-user",JSON.stringify(i(t)));const o=new CustomEvent("sitefellows/login");document.dispatchEvent(o),n&&SFUtils.RedirectToURL(n)})).catch((function(e){var t=e.code,n=e.message;console.warn("Firebase login error:",t,n);const o=new CustomEvent("sitefellows/login-error",{detail:n});document.dispatchEvent(o)}))}(e,t,n)},UserSignOut:function(){s()},ClearCache:function(){var e=window.localStorage;e.removeItem("sitefellows-config"),e.removeItem("sitefellows-config-timestamp"),e.removeItem("sitefellows-user"),s()}}}(),SiteFellowsUI=function(){function e(e,t){e.innerText=t,e.classList.add("show")}function t(t,n,o){return 0==t.value.length&&(e(n,o),!0)}function n(){window.localStorage;let e=SFUtils.GetLocalStoreUser();if(!SFUtils.IsInCMSEditor(SFUtils.GetLocalStoreConfig().SITE.options.cmsCompatibility)){document.querySelectorAll(".sf-generated-modal").forEach((function(e){e.remove()})),SFUtils.CheckIfHTMLElementExists('[href="#sf-login"]')&&SFUtils.ShowHideElements('[href="#sf-login"]',!e),SFUtils.CheckIfHTMLElementExists('[href="#sf-login-modal"]')&&SFUtils.ShowHideElements('[href="#sf-login-modal"]',!e),SFUtils.CheckIfHTMLElementExists('[href="#sf-register"]')&&SFUtils.ShowHideElements('[href="#sf-register"]',!e),SFUtils.CheckIfHTMLElementExists('[href="#sf-logout"]')&&SFUtils.ShowHideElements('[href="#sf-logout"]',!!e),SFUtils.CheckIfHTMLElementExists(".sf-login-form")&&SFUtils.ShowHideElements(".sf-login-form",!e),SFUtils.CheckIfHTMLElementExists(".sf-register-form")&&SFUtils.ShowHideElements(".sf-register-form",!e)}SFUtils.GetLocalStoreConfig()&&SFUtils.ShowLoader(!1)}function o(e="",t=""){const n=`data-id="${SFUtils.UUID()}"`;let o=`\n        <div class="sf-modal-container" ${n}>\n        <div class="sf-modal">\n            <div class="sf-header">\n                <p class="sf-title">${e}</p>\n                <div class="sf-button"></div>\n            </div>\n            <div class="sf-content"></div>\n            ${t?`<div class="sh-footer">${t}</div>`:""}\n        </div>\n        </div>`;var i=document.createElement("div");return i.classList.add("sf-generated-modal"),i.innerHTML=o,document.querySelector("body").appendChild(i),document.querySelector("["+n+"].sf-modal-container .sf-button").addEventListener("click",(function(e){i.remove()})),`.sf-modal-container[${n}] .sf-content`}function i(o,i){const s=`data-id="${SFUtils.UUID()}"`,l=`\n        <div class="sf-login-form sf-form-container" ${s}>\n        <div class="sf-form">\n            <div class="sf-form-field">\n                <label for="sf-login-user-email">Email</label>\n                <input type="email" name="sf-login-user-email" id="sf-login-user-email" placeholder="your.email@example.com">\n            </div>\n\n            <div class="sf-form-field">\n                <label for="sf-login-user-pass">Password</label>\n                <input type="password" name="sf-login-user-pass" id="sf-login-user-pass" placeholder="Enter your password">\n            </div>\n            <div class="sf-error-message">Error Message</div>\n            <button class="sf-button submit">Log in</button>\n        </div>\n    </div>`;if(SFUtils.CheckIfHTMLElementExists(o)){const m="["+s+"]";var r;document.querySelector(o).innerHTML=l;var a=document.querySelector(m+".sf-login-form"),c=document.querySelector(m+".sf-login-form #sf-login-user-email"),f=document.querySelector(m+".sf-login-form #sf-login-user-pass"),d=document.querySelector(m+".sf-login-form .sf-error-message");function u(n,o,i){return!t(n,i,"Email can't be empty.")&&(!function(t,n,o){return!SFUtils.CheckIfEmailAddressIsValid(t.value)&&(e(n,o),!0)}(n,i,"Email address is not valid.")&&!t(o,i,"Password can't be empty."))}document.querySelector(m+".sf-login-form .sf-button.submit").addEventListener("click",(function(e){d.classList.remove("show"),u(c,f,d)&&(a.classList.add("load"),r=s,SiteFellows.UserLoginWithEmail(c.value,f.value,i))})),document.addEventListener("sitefellows/login-error",(function(t){r==s&&e(d,t.detail),a.classList.remove("load")})),document.addEventListener("sitefellows/login",(function(e){a.classList.remove("load"),n()}))}}function s(e,t,n){if(SFUtils.CheckIfHTMLElementExists(e)){document.querySelector(e).addEventListener("click",(function(e){let o=SFUtils.GetLocalStoreConfig();n&&n(),SFUtils.RedirectToURL(o.SITE.paths[t]?o.SITE.paths[t]:""),e.preventDefault(),e.stopPropagation()}))}}return{_Init:function(){!function(){var e=!1,t=!1;function n(){if(e&&t){const e=new Event("sitefellow/config-and-html-loaded");document.dispatchEvent(e)}}document.addEventListener("sitefellow/config-loaded",(function(){e=!0,n()})),document.addEventListener("DOMContentLoaded",(function(e){t=!0,n()}))}(),document.addEventListener("sitefellow/config-and-html-loaded",(function(){!function(){if(!SFUtils.IsInCMSEditor(SFUtils.GetLocalStoreConfig().SITE.options.cmsCompatibility)){s('[href="#sf-login"]',"login"),s('[href="#sf-register"]',"register"),s('[href="#sf-logout"]',"",(function(){SiteFellows.UserSignOut()}));let e='[href="#sf-login-modal"]';if(SFUtils.CheckIfHTMLElementExists(e)){document.querySelector(e).addEventListener("click",(function(e){i(o("Login")),e.preventDefault(),e.stopPropagation()}))}}}(),n()}))},RenderLoginForm:function(e,t){i(e,t)},RenderLoginModal:function(e){i(o("Login"))},DisplayRule:function(e,t,n){},Update:function(){n()}}}();SFUtils.ShowLoader(!0),SiteFellows._Init(),SiteFellowsUI._Init();